version: '3'

includes:
  tools:
    taskfile: tools/Taskfile.yml
    dir: tools/
  example:
    taskfile: example/Taskfile.yml
    dir: example/

tasks:
  world:
    desc: perform verification + build steps
    aliases: [ default ]
    cmds:
      - task: fmt
      - task: lint
      - task: tools:install
      - task: start-test-dependencies
      - task: test
      - task: example:build
      - task: integration-test
      - task: clean-dependencies

  fmt: go fmt ./...
  lint: golangci-lint run ./...
  start-test-dependencies: docker compose up -d --wait --quiet-pull
  test:
    - go clean -testcache
    - go test ./...
  integration-test:
    - go clean -testcache
    - go test -tags=integration ./test/integration/...
  clean-dependencies:
    - go mod tidy
    - go mod verify

